<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>مشغل ملف M3U</title>
<style>
body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; }
h1 { text-align: center; }
#channels { margin-top: 20px; }
.channel { padding: 10px; border-bottom: 1px solid #ccc; cursor: pointer; }
#player { width: 100%; height: 500px; margin-top: 20px; }
</style>
</head>
<body>
<h1>مشغل ملف M3U</h1>
<input type="file" id="fileInput" accept=".m3u" />
<div id="channels"></div>
<video id="player" controls></video>

<script>
const fileInput = document.getElementById('fileInput');
const channelsDiv = document.getElementById('channels');
const player = document.getElementById('player');

let playlist = [];

fileInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const text = e.target.result;
            parseM3U(text);
        };
        reader.readAsText(file);
    }
});

function parseM3U(content) {
    channelsDiv.innerHTML = '';
    playlist = [];
    const lines = content.split('\n');
    let currentChannel = {};
    for (let line of lines) {
        line = line.trim();
        if (line.startsWith('#EXTINF')) {
            // استخراج اسم القناة
            const info = line.split(','); 
            currentChannel.name = info[1] || 'قناة';
        } else if (line && !line.startsWith('#')) {
            // هو الرابط
            currentChannel.url = line;
            playlist.push({ ...currentChannel });
            // عرض القناة
            displayChannel(currentChannel);
            currentChannel = {};
        }
    }
}

function displayChannel(channel) {
    const div = document.createElement('div');
    div.className = 'channel';
    div.textContent = channel.name;
    div.onclick = () => {
        playStream(channel.url);
    };
    channelsDiv.appendChild(div);
}

function playStream(url) {
    player.src = url;
    player.play();
}
</script>
</body>
</html>
